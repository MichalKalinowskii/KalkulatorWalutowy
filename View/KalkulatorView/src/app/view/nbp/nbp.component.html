<div class="container flex gap-4 max-w-fit">
    <div class="mt-3 ml-4">
        <mat-form-field>
            <mat-label>Wybierz date</mat-label>
            <input matInput [matDatepicker]="picker" (dateChange)="onDateChange($event)" [value]="datePickerValue">
            <mat-hint>DD/MM/RRRR</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
    </div>
    <div class="mt-7">
        <button type="submit" (click)="onTodayButtonClick()" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
            Najnowsze kursy
        </button>
    </div>
    @if (!userLoggedIn) {
        <div class="mt-7">
            <button (click)="openUserAuthModal()" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                Zaloguj/Zarejestruj się
            </button>
        </div>
    }
</div>

@if (difrentDataLoaded) {
    <div class="ml-4">
        <h2 class="text-red-500 font-bold">Brak danych dla wybranej daty, wyświetlono kursy dla wcześniejszej daty</h2>
    </div>
}

@if (showUserAuthModal && !closeModal) {
    <app-user-auth (userLoggedInEvent)="setUserLoggedIn($event)" (closeModalEvent)="closeModalClick()"></app-user-auth>
}
           
@if ((exchangeRates$ | async)?.rates; as rates) {
    <div class="container ml-5 flex">
        <!-- Table Section -->
        <div class="mr-12">
            <h1 class="text-2xl font-bold mb-2">Kursy walut</h1>
            <div class="max-h-[600px] overflow-y-auto border border-gray-300 relative">
                <table class="bg-white border border-gray-300">
                    <thead class="sticky top-0 bg-blue-500 text-white">
                        <tr>
                            <th class="py-3 px-4 border-gray-400 text-left text-lg">Waluta</th>
                            <th class="py-3 px-4 border-gray-400 text-left text-lg">Kod</th>
                            <th class="py-3 px-4 border-gray-400 text-left text-lg">Kurs</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (rate of rates.slice(1); track rate) {
                            <tr class="bg-white-200 odd:bg-white-200 even:bg-gray-100 transition-colors">
                                <td class="py-2 px-4 border-r border-gray-400 text-gray-800">{{ rate.currency }}</td>
                                <td class="py-2 px-4 border-r border-gray-400 text-gray-800">{{ rate.code }}</td>
                                <td class="py-2 px-4 text-gray-800">{{ rate.mid }}</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    
        <!-- Calculator Section -->
        <div class="w-1/4 ml-4 mt-10">
            <div>
                <app-calculator [rates]="rates"></app-calculator>
            </div>
            @if (userLoggedIn) {
                <div class="container mx-auto mt-10 w-full">
                    <div class="mt-4 flex items-start space-x-4">
                      <!-- Przyciski po lewej -->
                      <button 
                        (click)="saveNbpRates()" 
                        class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                        Zapisz
                      </button>
                      
                      <!-- Etykieta i sekcja po prawej -->

                      <div>
                        <label for="options" class="block text-lg">Wybierz datę do wczytania:</label>
                        <select id="options" 
                            class="mt-2 p-2 w-full border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option selected="selected">Wybierz datę</option>
                            @for (item of savedRates; track $index) {
                                <option (click)="updateRates(item)" [value]="item">{{item.effectiveDate}}</option>
                            }
                        </select>
                      </div>

                    </div>
                  </div>
            }
        </div>
    </div>  
} 
@else {
    <div class="container mx-auto p-4 float-left text-3xl font-bold">
        <h1>Brak danych na ten dzień</h1>
    </div>
}


